var ee=Object.defineProperty,ae=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var q=(e,t,s)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t)=>{for(var s in t||(t={}))I.call(t,s)&&q(e,s,t[s]);if(A)for(var s of A(t))D.call(t,s)&&q(e,s,t[s]);return e},w=(e,t)=>ae(e,se(t));var E=(e,t)=>{var s={};for(var r in e)I.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&A)for(var r of A(e))t.indexOf(r)<0&&D.call(e,r)&&(s[r]=e[r]);return s};var H=(e,t,s)=>new Promise((r,d)=>{var c=l=>{try{p(s.next(l))}catch(u){d(u)}},i=l=>{try{p(s.throw(l))}catch(u){d(u)}},p=l=>l.done?r(l.value):Promise.resolve(l.value).then(c,i);p((s=s.apply(e,t)).next())});import{r as n,ag as te,ah as re,j as a,w as oe,P as O,ai as ne,aj as ce,z as ie,A as le,ak as de,D as pe,G as B,H as ue,I as he,al as me,b as C,p as R,o as M,S as xe,s as fe,am as ve,a as V,i as ge,c as L,an as je,t as be,F as we,d as Se}from"./index-C04qYfe-.js";import ye from"./GatewayList-RtY8RNpH.js";import{u as Ce}from"./index-DDgf8gTd.js";import{o as ke}from"./card-C5T3GK1O.js";import{o as _e}from"./grid-DlTU2srM.js";import{o as W}from"./separator-DXU2HE4Y.js";import{m as Ee,b as Te,P as G,f as K}from"./tabs-DEgt-0wF.js";import{u as Pe}from"./text-field-CMR2eUSf.js";import"./index-rTswdvp2.js";var F="Switch",[Re,Je]=oe(F),[Ne,ze]=Re(F),X=n.forwardRef((e,t)=>{const z=e,{__scopeSwitch:s,name:r,checked:d,defaultChecked:c,required:i,disabled:p,value:l="on",onCheckedChange:u,form:v}=z,g=E(z,["__scopeSwitch","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]),[x,S]=n.useState(null),j=te(t,b=>S(b)),y=n.useRef(!1),k=x?v||!!x.closest("form"):!0,[f=!1,N]=re({prop:d,defaultProp:c,onChange:u});return a.jsxs(Ne,{scope:s,checked:f,disabled:p,children:[a.jsx(O.button,w(m({type:"button",role:"switch","aria-checked":f,"aria-required":i,"data-state":Y(f),"data-disabled":p?"":void 0,disabled:p,value:l},g),{ref:j,onClick:ne(e.onClick,b=>{N(U=>!U),k&&(y.current=b.isPropagationStopped(),y.current||b.stopPropagation())})})),k&&a.jsx(Ae,{control:x,bubbles:!y.current,name:r,value:l,checked:f,required:i,disabled:p,form:v,style:{transform:"translateX(-100%)"}})]})});X.displayName=F;var J="SwitchThumb",Q=n.forwardRef((e,t)=>{const c=e,{__scopeSwitch:s}=c,r=E(c,["__scopeSwitch"]),d=ze(J,s);return a.jsx(O.span,w(m({"data-state":Y(d.checked),"data-disabled":d.disabled?"":void 0},r),{ref:t}))});Q.displayName=J;var Ae=e=>{const l=e,{control:t,checked:s,bubbles:r=!0}=l,d=E(l,["control","checked","bubbles"]),c=n.useRef(null),i=Ce(s),p=ce(t);return n.useEffect(()=>{const u=c.current,v=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(v,"checked").set;if(i!==s&&x){const S=new Event("click",{bubbles:r});x.call(u,s),u.dispatchEvent(S)}},[i,s,r]),a.jsx("input",w(m({type:"checkbox","aria-hidden":!0,defaultChecked:s},d),{tabIndex:-1,ref:c,style:w(m(m({},e.style),p),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))};function Y(e){return e?"checked":"unchecked"}var Le=X,Ue=Q;const $e=["1","2","3"],Fe=["classic","surface","soft"],qe=m(m(m({size:{type:"enum",className:"rt-r-size",values:$e,default:"2",responsive:!0},variant:{type:"enum",className:"rt-variant",values:Fe,default:"surface"}},de),le),ie),P=n.forwardRef((e,t)=>{const i=pe(e,qe,ue),{className:s,color:r,radius:d}=i,c=E(i,["className","color","radius"]);return n.createElement(Le,w(m({"data-accent-color":r,"data-radius":d},c),{asChild:!1,ref:t,className:B("rt-reset","rt-SwitchRoot",s)}),n.createElement(Ue,{className:B("rt-SwitchThumb",{"rt-high-contrast":e.highContrast})}))});P.displayName="Switch";const Ie=({message:e,type:t,onClose:s})=>(n.useEffect(()=>{const r=setTimeout(()=>{s()},3e3);return()=>clearTimeout(r)},[s]),a.jsxs("div",{style:{position:"fixed",bottom:"20px",right:"20px",zIndex:1e3,backgroundColor:t==="success"?"var(--green-9)":"var(--red-9)",color:"white",padding:"12px 16px",borderRadius:"4px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.2)",display:"flex",alignItems:"center",gap:"8px"},children:[t==="success"?a.jsx(we,{size:16}):a.jsx(Se,{size:16}),a.jsx(L,{size:"2",children:e})]})),Qe=()=>{const{data:e,isLoading:t,error:s,mutate:r}=he("Cool Track Settings","Cool Track Settings"),{updateDoc:d,loading:c}=me(),[i,p]=n.useState({}),[l,u]=n.useState(!1),[v,g]=n.useState(null),[x,S]=n.useState(""),[j,y]=n.useState(null);n.useEffect(()=>{e!=null&&e.api_url&&S(e.api_url)},[e==null?void 0:e.api_url]),n.useEffect(()=>{const o=setTimeout(()=>{x!==(e==null?void 0:e.api_url)&&k(x)},500);return()=>clearTimeout(o)},[x,e==null?void 0:e.api_url]);const k=o=>{if(!o)return g("API URL is required"),!1;try{return new URL(o),g(null),!0}catch(h){return g("Please enter a valid URL (e.g., https://example.com/api)"),!1}},f=(o,h)=>{p(Z=>w(m({},Z),{[o]:h})),o==="api_url"&&S(h),u(!0)},N=()=>H(void 0,null,function*(){const o=i.api_url||(e==null?void 0:e.api_url);if(k(o))try{yield d("Cool Track Settings","Cool Track Settings",i),r(),u(!1),b("Settings saved successfully","success")}catch(h){console.error("Error saving settings:",h),b("Failed to save settings. Please try again.","error")}}),z=()=>{p({}),u(!1),g(null)},b=(o,h)=>{y({message:o,type:h,show:!0})},U=()=>{y(null)},_=o=>i[o]!==void 0?i[o]:e==null?void 0:e[o];return n.useEffect(()=>{const o=h=>{h.ctrlKey&&h.key==="s"&&(h.preventDefault(),N())};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[]),a.jsxs(C,{className:"px-4 py-3 w-full",children:[(j==null?void 0:j.show)&&a.jsx(Ie,{message:j.message,type:j.type,onClose:U}),l&&a.jsx(C,{className:"bg-white p-4 sticky top-[50px] z-50 border-b border-gray-200 shadow-md",children:a.jsx(R,{justify:"end",align:"end",children:a.jsxs(R,{gap:"2",children:[a.jsxs(M,{variant:"soft",color:"gray",onClick:z,children:[c?"":a.jsx(xe,{}),c?"":"Cancel"]}),a.jsxs(M,{onClick:N,disabled:c||!!v,children:[c?a.jsx(fe,{}):a.jsx(ve,{}),c?"":"Save Changes"]})]})})}),a.jsxs(Ee,{defaultValue:"general",children:[a.jsxs(Te,{children:[a.jsx(G,{value:"general",children:"General Settings"}),a.jsx(G,{value:"gateways",children:"Locations"})]}),a.jsx(K,{value:"general",children:a.jsx(C,{className:"mx-auto py-4",children:a.jsx(ke,{className:"shadow-sm w-full",children:a.jsxs(R,{direction:"column",gap:"4",p:"6",children:[a.jsx(V,{size:"6",mb:"4",children:"Settings"}),a.jsx($,{title:"API Configuration",icon:a.jsx(ge,{})}),a.jsxs(T,{label:"API URL",description:"The endpoint URL for sensor data reception",fullWidth:!0,children:[a.jsx(Pe,{value:_("api_url")||"",onChange:o=>f("api_url",o.target.value),placeholder:"https://example.com/api/method/receive_sensor_data",className:`w-full p-2 border rounded-md ${v?"border-red-500":"border-gray-300"}`}),v&&a.jsx(L,{size:"1",color:"red",mt:"1",children:v})]}),a.jsx(W,{size:"4"}),a.jsx($,{title:"Approval Settings",icon:a.jsx(je,{})}),a.jsx(T,{label:"Require Location Approval",description:"When enabled, all new locations must be manually approved before they can connect to the server.",children:a.jsx(P,{checked:_("require_gateway_approval"),onCheckedChange:o=>f("require_gateway_approval",o)})}),a.jsx(T,{label:"Require Sensor Approval",description:"When enabled, all new sensors must be approved before they can send data to the server.",children:a.jsx(P,{checked:_("require_sensor_approval"),onCheckedChange:o=>f("require_sensor_approval",o)})}),a.jsx(T,{label:"Log Approval Activities",description:"When enabled, detailed audit logs of all approval/rejection activities are generated.",children:a.jsx(P,{checked:_("log_approval_activities"),onCheckedChange:o=>f("log_approval_activities",o)})}),a.jsx(W,{size:"4"}),a.jsx($,{title:"Notification Settings",icon:a.jsx(be,{})}),a.jsx(T,{label:"Send Approval Notifications",description:"When enabled, email notifications are sent to system managers when a new gateway or sensor requires approval.",children:a.jsx(P,{checked:_("send_approval_notifications"),onCheckedChange:o=>f("send_approval_notifications",o)})})]})})})}),a.jsx(K,{value:"gateways",children:a.jsx(C,{className:"mx-auto py-4",children:a.jsx(ye,{})})})]})]})},$=({title:e,icon:t})=>a.jsxs(R,{gap:"3",align:"center",mb:"4",children:[a.jsx(C,{className:"text-gray-500",children:t}),a.jsx(V,{size:"4",weight:"medium",children:e})]}),T=({label:e,description:t,children:s,fullWidth:r=!1})=>a.jsxs(_e,{columns:r?"1":"2",gap:"5",mb:"4",children:[a.jsxs(R,{direction:"column",children:[a.jsx(L,{weight:"medium",children:e}),t&&a.jsx(L,{size:"2",color:"gray",mt:"1",children:t})]}),!r&&a.jsx(C,{children:s}),r&&s]});export{Qe as default};
