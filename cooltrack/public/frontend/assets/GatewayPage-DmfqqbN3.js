var C=(N,g,c)=>new Promise((m,l)=>{var v=s=>{try{p(c.next(s))}catch(h){l(h)}},d=s=>{try{p(c.throw(s))}catch(h){l(h)}},p=s=>s.done?m(s.value):Promise.resolve(s.value).then(v,d);p((c=c.apply(N,g)).next())});import{N as re,u as te,R as F,I as ne,E as M,j as e,p as r,s as le,c as t,o as j,O as T,b as x,q as E,Q as w,a as G,F as X,S as $,T as R,U as H,V as U,W as oe,X as Y,v as Z,Y as ce,Z as W,_ as J,$ as B,a0 as z,a1 as D,a2 as O}from"./index-C04qYfe-.js";import{p as A}from"./container-C1HFv2hJ.js";import{o as f}from"./card-C5T3GK1O.js";import{s as de,p as je,g as xe,m as me,D as pe}from"./dialog-QXb7-LxA.js";import{o as V}from"./grid-DlTU2srM.js";import{c as he}from"./scroll-area-C6CETP3U.js";import{o as n}from"./separator-DXU2HE4Y.js";import{m as ue,b as ge,P as k}from"./tabs-DEgt-0wF.js";import{r as ve}from"./text-area-Be0m9nCr.js";import"./get-subtree-DIlR1yYT.js";import"./index-CuX96acz.js";import"./index-rTswdvp2.js";const ye={LTE:e.jsx(J,{className:"text-blue-500",size:20}),Ethernet:e.jsx(O,{className:"text-purple-500",size:20}),USB:e.jsx(z,{className:"text-green-500",size:20}),IoT:e.jsx(w,{className:"text-orange-500",size:20}),SS:e.jsx(O,{className:"text-purple-500",size:20}),WSA:e.jsx(z,{className:"text-green-500",size:20})},q={Active:{icon:e.jsx(w,{size:14}),color:"green"},Inactive:{icon:e.jsx(D,{size:14}),color:"gray"},Maintenance:{icon:e.jsx(Y,{size:14}),color:"orange"},Decommissioned:{icon:e.jsx(D,{size:14}),color:"red"}},Q={Pending:{icon:e.jsx(Z,{size:14}),color:"blue"},Approved:{icon:e.jsx(X,{size:14}),color:"green"},Rejected:{icon:e.jsx($,{size:14}),color:"red"},Decommissioned:{icon:e.jsx(D,{size:14}),color:"gray"}},De=()=>{var P;const{id:N}=re(),g=te(),[c,m]=F.useState(!1),[l,v]=F.useState(""),[d,p]=F.useState("details"),{data:s,isLoading:h,error:y,mutate:I}=ne("Sensor Gateway",N),{call:L,loading:_}=M("frappe.client.set_value"),{call:K,loading:ee}=M("frappe.client.set_value"),se=()=>C(void 0,null,function*(){try{yield L({doctype:"Sensor Gateway",name:s==null?void 0:s.name,fieldname:"approval_status",value:"Approved"}),I()}catch(i){console.error("Failed to approve gateway:",i)}}),ae=()=>C(void 0,null,function*(){try{yield L({doctype:"Sensor Gateway",name:s==null?void 0:s.name,fieldname:"approval_status",value:"Rejected"}),l&&(yield K({doctype:"Sensor Gateway",name:s==null?void 0:s.name,fieldname:"notes",value:`Gateway rejected. Reason: ${l}`})),I(),m(!1),v("")}catch(i){console.error("Failed to reject gateway:",i)}}),S=i=>i?new Date(i).toLocaleString():"Not available",ie=({title:i,icon:u})=>e.jsxs(r,{gap:"3",align:"center",mb:"2",children:[e.jsx(x,{className:"text-gray-500",children:u}),e.jsx(G,{size:"4",weight:"medium",children:i})]}),o=({title:i,icon:u,children:b})=>e.jsxs(f,{variant:"surface",className:"hover:shadow-md transition-shadow",children:[e.jsx(ie,{title:i,icon:u}),b]}),a=({label:i,value:u,icon:b})=>e.jsxs(r,{direction:"column",gap:"1",py:"2",children:[e.jsxs(r,{align:"center",gap:"2",children:[b&&e.jsx(x,{className:"text-gray-400",children:b}),e.jsx(t,{size:"1",className:"text-gray-500 uppercase tracking-wider",children:i})]}),e.jsx(t,{size:"2",weight:"medium",className:"text-gray-900",children:u||"—"})]});return h?e.jsx(r,{justify:"center",align:"center",className:"h-[80vh]",children:e.jsx(le,{size:"3"})}):y||!s?e.jsx(A,{size:"4",className:"h-[80vh] flex items-center justify-center",children:e.jsx(f,{className:"max-w-md w-full",children:e.jsxs(r,{direction:"column",gap:"4",align:"center",p:"4",children:[e.jsx(t,{color:"red",weight:"bold",size:"4",children:"Error loading gateway"}),e.jsx(t,{color:"gray",children:(y==null?void 0:y.message)||"Gateway not found"}),e.jsxs(j,{onClick:()=>g("/gateways"),variant:"soft",className:"mt-4",children:[e.jsx(T,{})," Return to Locations"]})]})})}):e.jsxs(x,{p:"4",children:[e.jsx(x,{className:"bg-white border-b border-gray-200 p-4 sticky top-0 z-10 shadow-sm",children:e.jsx(A,{size:"4",children:e.jsxs(r,{justify:"between",align:"center",children:[e.jsxs(j,{variant:"soft",onClick:()=>g("/gateways"),size:"2",children:[e.jsx(T,{})," All Locations"]}),e.jsxs(r,{gap:"3",align:"center",children:[e.jsx(E,{color:q[s.status].color,highContrast:!0,className:"uppercase",children:e.jsxs(r,{gap:"2",align:"center",children:[q[s.status].icon,s.status]})}),e.jsx(E,{color:Q[s.approval_status].color,highContrast:!0,className:"uppercase",children:e.jsxs(r,{gap:"2",align:"center",children:[Q[s.approval_status].icon,s.approval_status]})})]})]})})}),e.jsxs(A,{size:"4",py:"6",children:[e.jsxs(f,{className:"shadow-sm mb-6",children:[e.jsxs(r,{gap:"4",align:"center",p:"4",children:[e.jsx(x,{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:ye[s.gateway_type]||e.jsx(w,{size:24})}),e.jsxs(r,{direction:"column",children:[e.jsx(G,{size:"5",weight:"bold",className:"text-gray-900",children:s.model_number||s.name}),e.jsxs(t,{color:"gray",size:"2",children:["Serial: ",s.serial_number||"Not specified"," • ID: ",s.name]})]})]}),s.approval_status==="Pending"&&e.jsxs(r,{gap:"3",p:"4",justify:"end",className:"bg-gray-50 rounded-b-lg",children:[e.jsxs(j,{variant:"solid",color:"green",onClick:se,disabled:_,size:"2",children:[e.jsx(X,{})," Approve"]}),e.jsxs(j,{variant:"soft",color:"red",onClick:()=>m(!0),disabled:_,size:"2",children:[e.jsx($,{})," Reject"]})]})]}),e.jsxs(ue,{value:d,onValueChange:p,children:[e.jsxs(ge,{className:"mb-4",children:[e.jsx(k,{value:"details",children:"Details"}),e.jsx(k,{value:"connectivity",children:"Connectivity"}),e.jsx(k,{value:"history",children:"History"})]}),e.jsx(he,{type:"auto",scrollbars:"vertical",style:{height:"calc(100vh - 250px)"},children:e.jsxs(x,{pr:"4",children:[d==="details"&&e.jsxs(V,{columns:{initial:"1",md:"2"},gap:"4",children:[e.jsxs(o,{title:"Basic Information",icon:e.jsx(H,{}),children:[e.jsx(a,{label:"Gateway Type",value:s.gateway_type,icon:e.jsx(w,{})}),e.jsx(n,{size:"1"}),e.jsx(a,{label:"Model Number",value:s.model_number,icon:e.jsx(R,{})}),e.jsx(n,{size:"1"}),e.jsx(a,{label:"Serial Number",value:s.serial_number,icon:e.jsx(R,{})}),e.jsx(n,{size:"1"}),e.jsx(a,{label:"Firmware Version",value:s.firmware_version,icon:e.jsx(R,{})})]}),e.jsxs(o,{title:"Location",icon:e.jsx(oe,{}),children:[e.jsx(a,{label:"Site Location",value:s.location}),e.jsx(n,{size:"1"}),e.jsx(a,{label:"Installed On",value:S(s.installation_date),icon:e.jsx(U,{})})]}),e.jsxs(o,{title:"Activity",icon:e.jsx(Z,{}),children:[e.jsx(a,{label:"Last Heartbeat",value:S(s.last_heartbeat),icon:e.jsx(U,{})}),e.jsx(n,{size:"1"}),e.jsx(a,{label:"Transmissions",value:(P=s.number_of_transmissions)==null?void 0:P.toLocaleString()}),e.jsx(n,{size:"1"}),e.jsx(a,{label:"Last Maintenance",value:S(s.last_maintenance),icon:e.jsx(Y,{})})]}),s.notes&&e.jsx(o,{title:"Notes",icon:e.jsx(H,{}),children:e.jsx(t,{className:"whitespace-pre-line p-2 bg-gray-50 rounded text-gray-700",children:s.notes})})]}),d==="connectivity"&&e.jsxs(V,{columns:{initial:"1",md:"2"},gap:"4",children:[e.jsxs(o,{title:"Network",icon:e.jsx(W,{}),children:[e.jsx(a,{label:"IP Address",value:s.ip_address,icon:e.jsx(ce,{})}),e.jsx(n,{size:"1"}),e.jsx(a,{label:"MAC Address",value:s.mac_address,icon:e.jsx(W,{})})]}),e.jsxs(o,{title:"Mobile",icon:e.jsx(B,{}),children:[e.jsx(a,{label:"Network Provider",value:s.network_provider,icon:e.jsx(J,{})}),e.jsx(n,{size:"1"}),e.jsx(a,{label:"SIM Card Number",value:s.sim_card_number,icon:e.jsx(B,{})})]}),e.jsx(o,{title:"Ports",icon:e.jsx(z,{}),children:e.jsx(a,{label:"USB Port",value:s.usb_port,icon:e.jsx(z,{})})})]}),d==="history"&&e.jsx(f,{children:e.jsx(t,{color:"gray",children:"History data will appear here"})})]})})]})]}),e.jsx(de,{open:c,onOpenChange:m,children:e.jsxs(je,{style:{maxWidth:450},children:[e.jsx(xe,{children:"Reject Gateway"}),e.jsx(me,{size:"2",mb:"4",children:"Please provide a reason for rejecting this gateway."}),e.jsx(r,{direction:"column",gap:"3",children:e.jsxs("label",{children:[e.jsx(t,{as:"div",size:"2",mb:"1",weight:"bold",children:"Reason"}),e.jsx(ve,{placeholder:"Enter rejection reason...",value:l,onChange:i=>v(i.target.value),className:"min-h-[100px]"})]})}),e.jsxs(r,{gap:"3",mt:"4",justify:"end",children:[e.jsx(pe,{children:e.jsx(j,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(j,{variant:"solid",color:"red",onClick:ae,disabled:!l||_||ee,children:[e.jsx($,{})," Confirm Reject"]})]})]})})]})};export{De as default};
