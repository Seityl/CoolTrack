var A=(d,f,o)=>new Promise((x,m)=>{var y=t=>{try{l(o.next(t))}catch(c){m(c)}},O=t=>{try{l(o.throw(t))}catch(c){m(c)}},l=t=>t.done?x(t.value):Promise.resolve(t.value).then(y,O);l((o=o.apply(d,f)).next())});import{c as te,w as ne,y as re,r as n,j as e,p as r,b as ae,o as i,F as oe,s as ie,d as le}from"./index-X4KS0kgS.js";import{m as ce,d as de,P as L,f as P,b as he,T as B}from"./table-DsyRdIWN.js";import{P as ue,R as xe,T as me,V as je}from"./index-ByvXj5_F.js";import{S as pe}from"./SortByDropdown-BIn9PZqH.js";import{o as ge}from"./card-CA4iMPDQ.js";import{s as W,n as fe,p as Q,g as V,m as G,D as _}from"./dialog-BIPX10Di.js";import{u as q}from"./text-field-CI2Gm0u8.js";import{p as b}from"./text-fCUYU7-V.js";import"./index-o7eMGu49.js";import"./index-DBV7CZlc.js";const ze=()=>{const{data:d,isLoading:f,error:o,mutate:x}=te("UOM",{fields:["name","creation"],orderBy:{field:"creation",order:"desc"}}),{deleteDoc:m}=ne(),{createDoc:y}=re(),[O,l]=n.useState(null),[t,c]=n.useState(null),[H,w]=n.useState(!1),[J,z]=n.useState(!1),[T,F]=n.useState(""),[E,h]=n.useState(null),[N,U]=n.useState(!1),[M,K]=n.useState("creation"),[S,k]=n.useState("desc"),[I,R]=n.useState(""),[X,C]=n.useState(!1),[Y,j]=n.useState(""),[Z,p]=n.useState("success"),ee=()=>A(void 0,null,function*(){if(t){l(t);try{yield m("UOM",t),x(),p("success"),j("UOM deleted successfully.")}catch(s){p("error"),j("Failed to delete UOM.")}finally{C(!0),l(null),c(null),w(!1)}}}),se=()=>A(void 0,null,function*(){U(!0),h(null);const s=T.trim();if(!s){h("UOM name cannot be empty."),U(!1);return}try{yield y("UOM",{uom_name:s}),z(!1),F(""),x(),p("success"),j("UOM added successfully.")}catch(a){const u=(a==null?void 0:a.message)||"",g=(a==null?void 0:a.exception)||"";u.includes("Duplicate")||g.includes("DuplicateEntryError")?h("A UOM with this name already exists."):u.toLowerCase().includes("validation")?h("Invalid UOM name."):h("Failed to create UOM."),p("error"),j("Failed to add UOM.")}finally{U(!1),C(!0)}}),D=d==null?void 0:d.filter(s=>s.name.toLowerCase().includes(I.toLowerCase())),v=D==null?void 0:D.sort((s,a)=>{const u=s[M],g=a[M],$=u<g?-1:u>g?1:0;return S==="asc"?$:-$});return e.jsxs(ue,{swipeDirection:"right",children:[e.jsx(ge,{p:"4",m:"4",children:e.jsxs(r,{direction:"column",gap:"4",children:[e.jsxs(r,{justify:"between",align:"center",children:[e.jsx(ae,{size:"6",children:"UOMs"}),e.jsxs(W,{open:J,onOpenChange:z,children:[e.jsx(fe,{children:e.jsxs(i,{variant:"solid",color:"blue",size:"2",children:[e.jsx(oe,{style:{marginRight:6}}),"Add UOM"]})}),e.jsxs(Q,{style:{maxWidth:400},children:[e.jsx(V,{children:"Add a New UOM"}),e.jsx(G,{size:"2",children:"Enter the name of the new Unit of Measure."}),e.jsxs(r,{direction:"column",gap:"3",mt:"4",children:[e.jsx(q,{placeholder:"UOM Name",value:T,onChange:s=>F(s.target.value)}),E&&e.jsx(b,{color:"red",size:"1",children:E})]}),e.jsxs(r,{gap:"3",mt:"4",justify:"end",children:[e.jsx(_,{children:e.jsx(i,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(i,{onClick:se,disabled:N,children:N?"Adding...":"Add UOM"})]})]})]})]}),e.jsx(r,{direction:"column",gap:"4",children:e.jsxs(r,{justify:"space-between",align:"start",gap:"3",style:{width:"100%"},children:[e.jsx(q,{placeholder:"Search UOM",value:I,onChange:s=>R(s.target.value),clearable:!0,onClear:()=>R(""),style:{flexGrow:1,minWidth:200,height:36}}),e.jsxs(r,{direction:"row",align:"start",gap:"2",children:[e.jsx(pe,{sortField:M,setSortField:K,setSortOrder:k}),e.jsx(i,{variant:"soft",color:"gray",onClick:()=>k(S==="asc"?"desc":"asc"),size:"2",style:{height:36,padding:"0 12px"},children:S==="asc"?"Ascending":"Descending"})]})]})}),f?e.jsx(r,{align:"center",justify:"center",p:"6",children:e.jsx(ie,{size:"3"})}):o?e.jsxs(b,{color:"red",size:"2",children:["Failed to load UOMs: ",o.message]}):!v||v.length===0?e.jsx(b,{size:"2",color:"gray",children:"No UOMs found."}):e.jsxs(ce,{variant:"surface",children:[e.jsx(de,{children:e.jsxs(L,{children:[e.jsx(P,{children:"Name"}),e.jsx(P,{children:"Actions"})]})}),e.jsx(he,{children:v.map(s=>e.jsxs(L,{children:[e.jsx(B,{children:s.name}),e.jsx(B,{children:e.jsx(i,{onClick:()=>{c(s.name),w(!0)},variant:"outline",color:"red",size:"1",disabled:O===s.name,children:e.jsx(le,{})})})]},s.name))})]})]})}),e.jsx(W,{open:H,onOpenChange:w,children:e.jsxs(Q,{style:{maxWidth:400},children:[e.jsx(V,{children:"Confirm Delete"}),e.jsxs(G,{children:["Are you sure you want to delete UOM ",e.jsx("strong",{children:t}),"?"]}),e.jsxs(r,{mt:"4",justify:"end",gap:"3",children:[e.jsx(_,{children:e.jsx(i,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(i,{onClick:ee,color:"red",disabled:!t,children:"Delete"})]})]})}),e.jsx(xe,{open:X,onOpenChange:C,duration:3e3,style:{backgroundColor:Z==="success"?"var(--green-5)":"var(--red-5)",color:"white",borderRadius:"6px",padding:"12px 16px",fontSize:"14px",position:"fixed",bottom:20,right:20,zIndex:1e3},children:e.jsx(me,{children:Y})}),e.jsx(je,{})]})};export{ze as default};
