var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var I=(e,t,s)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t)=>{for(var s in t||(t={}))L.call(t,s)&&I(e,s,t[s]);if(A)for(var s of A(t))D.call(t,s)&&I(e,s,t[s]);return e},w=(e,t)=>Z(e,ee(t));var _=(e,t)=>{var s={};for(var r in e)L.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&A)for(var r of A(e))t.indexOf(r)<0&&D.call(e,r)&&(s[r]=e[r]);return s};var H=(e,t,s)=>new Promise((r,d)=>{var c=l=>{try{p(s.next(l))}catch(u){d(u)}},i=l=>{try{p(s.throw(l))}catch(u){d(u)}},p=l=>l.done?r(l.value):Promise.resolve(l.value).then(c,i);p((s=s.apply(e,t)).next())});import{r as n,ag as ae,ah as se,j as a,w as te,P as G,ai as re,aj as oe,z as ne,A as ce,ak as ie,D as le,G as W,H as de,I as pe,al as ue,b as P,p as R,o as B,W as he,s as me,am as xe,a as K,i as fe,c as U,an as ve,t as ge,F as be,d as je}from"./index-BVgz5S1Z.js";import{u as we}from"./index-BxKdqQ_s.js";import{o as Ce}from"./card-M61IZ-ns.js";import{o as Se}from"./grid-BDn360O0.js";import{o as M}from"./separator-BTa1UTzN.js";import{u as ye}from"./text-field-BdL2Ghhu.js";var q="Switch",[ke,We]=te(q),[_e,Ee]=ke(q),O=n.forwardRef((e,t)=>{const z=e,{__scopeSwitch:s,name:r,checked:d,defaultChecked:c,required:i,disabled:p,value:l="on",onCheckedChange:u,form:v}=z,g=_(z,["__scopeSwitch","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]),[x,C]=n.useState(null),b=ae(t,j=>C(j)),S=n.useRef(!1),y=x?v||!!x.closest("form"):!0,[f=!1,N]=se({prop:d,defaultProp:c,onChange:u});return a.jsxs(_e,{scope:s,checked:f,disabled:p,children:[a.jsx(G.button,w(m({type:"button",role:"switch","aria-checked":f,"aria-required":i,"data-state":J(f),"data-disabled":p?"":void 0,disabled:p,value:l},g),{ref:b,onClick:re(e.onClick,j=>{N($=>!$),y&&(S.current=j.isPropagationStopped(),S.current||j.stopPropagation())})})),y&&a.jsx(Te,{control:x,bubbles:!S.current,name:r,value:l,checked:f,required:i,disabled:p,form:v,style:{transform:"translateX(-100%)"}})]})});O.displayName=q;var V="SwitchThumb",X=n.forwardRef((e,t)=>{const c=e,{__scopeSwitch:s}=c,r=_(c,["__scopeSwitch"]),d=Ee(V,s);return a.jsx(G.span,w(m({"data-state":J(d.checked),"data-disabled":d.disabled?"":void 0},r),{ref:t}))});X.displayName=V;var Te=e=>{const l=e,{control:t,checked:s,bubbles:r=!0}=l,d=_(l,["control","checked","bubbles"]),c=n.useRef(null),i=we(s),p=oe(t);return n.useEffect(()=>{const u=c.current,v=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(v,"checked").set;if(i!==s&&x){const C=new Event("click",{bubbles:r});x.call(u,s),u.dispatchEvent(C)}},[i,s,r]),a.jsx("input",w(m({type:"checkbox","aria-hidden":!0,defaultChecked:s},d),{tabIndex:-1,ref:c,style:w(m(m({},e.style),p),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))};function J(e){return e?"checked":"unchecked"}var Pe=O,Re=X;const Ne=["1","2","3"],ze=["classic","surface","soft"],Ae=m(m(m({size:{type:"enum",className:"rt-r-size",values:Ne,default:"2",responsive:!0},variant:{type:"enum",className:"rt-variant",values:ze,default:"surface"}},ie),ce),ne),T=n.forwardRef((e,t)=>{const i=le(e,Ae,de),{className:s,color:r,radius:d}=i,c=_(i,["className","color","radius"]);return n.createElement(Pe,w(m({"data-accent-color":r,"data-radius":d},c),{asChild:!1,ref:t,className:W("rt-reset","rt-SwitchRoot",s)}),n.createElement(Re,{className:W("rt-SwitchThumb",{"rt-high-contrast":e.highContrast})}))});T.displayName="Switch";const Ue=({message:e,type:t,onClose:s})=>(n.useEffect(()=>{const r=setTimeout(()=>{s()},3e3);return()=>clearTimeout(r)},[s]),a.jsxs("div",{style:{position:"fixed",bottom:"20px",right:"20px",zIndex:1e3,backgroundColor:t==="success"?"var(--green-9)":"var(--red-9)",color:"white",padding:"12px 16px",borderRadius:"4px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.2)",display:"flex",alignItems:"center",gap:"8px"},children:[t==="success"?a.jsx(be,{size:16}):a.jsx(je,{size:16}),a.jsx(U,{size:"2",children:e})]})),Be=()=>{const{data:e,isLoading:t,error:s,mutate:r}=pe("Cool Track Settings","Cool Track Settings"),{updateDoc:d,loading:c}=ue(),[i,p]=n.useState({}),[l,u]=n.useState(!1),[v,g]=n.useState(null),[x,C]=n.useState(""),[b,S]=n.useState(null);n.useEffect(()=>{e!=null&&e.api_url&&C(e.api_url)},[e==null?void 0:e.api_url]),n.useEffect(()=>{const o=setTimeout(()=>{x!==(e==null?void 0:e.api_url)&&y(x)},500);return()=>clearTimeout(o)},[x,e==null?void 0:e.api_url]);const y=o=>{if(!o)return g("API URL is required"),!1;try{return new URL(o),g(null),!0}catch(h){return g("Please enter a valid URL (e.g., https://example.com/api)"),!1}},f=(o,h)=>{p(Q=>w(m({},Q),{[o]:h})),o==="api_url"&&C(h),u(!0)},N=()=>H(void 0,null,function*(){const o=i.api_url||(e==null?void 0:e.api_url);if(y(o))try{yield d("Cool Track Settings","Cool Track Settings",i),r(),u(!1),j("Settings saved successfully","success")}catch(h){console.error("Error saving settings:",h),j("Failed to save settings. Please try again.","error")}}),z=()=>{p({}),u(!1),g(null)},j=(o,h)=>{S({message:o,type:h,show:!0})},$=()=>{S(null)},k=o=>i[o]!==void 0?i[o]:e==null?void 0:e[o];return n.useEffect(()=>{const o=h=>{h.ctrlKey&&h.key==="s"&&(h.preventDefault(),N())};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[]),a.jsxs(P,{className:"px-4 py-3 w-full",children:[(b==null?void 0:b.show)&&a.jsx(Ue,{message:b.message,type:b.type,onClose:$}),l&&a.jsx(P,{className:"bg-white p-4 sticky top-[50px] z-50 border-b border-gray-200 shadow-md",children:a.jsx(R,{justify:"end",align:"end",children:a.jsxs(R,{gap:"2",children:[a.jsxs(B,{variant:"soft",color:"gray",onClick:z,children:[c?"":a.jsx(he,{}),c?"":"Cancel"]}),a.jsxs(B,{onClick:N,disabled:c||!!v,children:[c?a.jsx(me,{}):a.jsx(xe,{}),c?"":"Save Changes"]})]})})}),a.jsx(P,{className:"mx-auto py-4",children:a.jsx(Ce,{className:"shadow-sm w-full",children:a.jsxs(R,{direction:"column",gap:"4",p:"6",children:[a.jsx(K,{size:"6",mb:"4",children:"Settings"}),a.jsx(F,{title:"API Configuration",icon:a.jsx(fe,{})}),a.jsxs(E,{label:"API URL",description:"The endpoint URL for sensor data reception",fullWidth:!0,children:[a.jsx(ye,{value:k("api_url")||"",onChange:o=>f("api_url",o.target.value),placeholder:"https://example.com/api/method/receive_sensor_data",className:`w-full p-2 border rounded-md ${v?"border-red-500":"border-gray-300"}`}),v&&a.jsx(U,{size:"1",color:"red",mt:"1",children:v})]}),a.jsx(M,{size:"4"}),a.jsx(F,{title:"Approval Settings",icon:a.jsx(ve,{})}),a.jsx(E,{label:"Require Gateway Approval",description:"When enabled, all new gateways must be manually approved before they can connect to the server.",children:a.jsx(T,{checked:k("require_gateway_approval"),onCheckedChange:o=>f("require_gateway_approval",o)})}),a.jsx(E,{label:"Require Sensor Approval",description:"When enabled, all new sensors must be approved before they can send data to the server.",children:a.jsx(T,{checked:k("require_sensor_approval"),onCheckedChange:o=>f("require_sensor_approval",o)})}),a.jsx(E,{label:"Log Approval Activities",description:"When enabled, detailed audit logs of all approval/rejection activities are generated.",children:a.jsx(T,{checked:k("log_approval_activities"),onCheckedChange:o=>f("log_approval_activities",o)})}),a.jsx(M,{size:"4"}),a.jsx(F,{title:"Notification Settings",icon:a.jsx(ge,{})}),a.jsx(E,{label:"Send Approval Notifications",description:"When enabled, email notifications are sent to system managers when a new gateway or sensor requires approval.",children:a.jsx(T,{checked:k("send_approval_notifications"),onCheckedChange:o=>f("send_approval_notifications",o)})})]})})})]})},F=({title:e,icon:t})=>a.jsxs(R,{gap:"3",align:"center",mb:"4",children:[a.jsx(P,{className:"text-gray-500",children:t}),a.jsx(K,{size:"4",weight:"medium",children:e})]}),E=({label:e,description:t,children:s,fullWidth:r=!1})=>a.jsxs(Se,{columns:r?"1":"2",gap:"5",mb:"4",children:[a.jsxs(R,{direction:"column",children:[a.jsx(U,{weight:"medium",children:e}),t&&a.jsx(U,{size:"2",color:"gray",mt:"1",children:t})]}),!r&&a.jsx(P,{children:s}),r&&s]});export{Be as default};
