var C=(c,m,n)=>new Promise((p,u)=>{var x=r=>{try{l(n.next(r))}catch(a){u(a)}},j=r=>{try{l(n.throw(r))}catch(a){u(a)}},l=r=>r.done?p(r.value):Promise.resolve(r.value).then(x,j);l((n=n.apply(c,m)).next())});import{c as T,w as W,y as G,r as i,j as e,p as t,b as q,o as d,F as H,s as J,d as K}from"./index-X4KS0kgS.js";import{m as M,d as U,P as k,f as B,b as V,T as I}from"./table-DsyRdIWN.js";import{S as X}from"./SortByDropdown-BIn9PZqH.js";import{o as Y}from"./card-CA4iMPDQ.js";import{s as Z,n as ee,p as se,g as re,m as ie,D as te}from"./dialog-BIPX10Di.js";import{u as O}from"./text-field-CI2Gm0u8.js";import{p as b}from"./text-fCUYU7-V.js";import"./index-o7eMGu49.js";const me=()=>{const{data:c,isLoading:m,error:n,mutate:p}=T("Supplier",{fields:["name","supplier_name","creation"],orderBy:{field:"creation",order:"desc"}}),{deleteDoc:u}=W(),{createDoc:x}=G(),[j,l]=i.useState(null),[r,a]=i.useState(!1),[g,v]=i.useState(""),[z,h]=i.useState(null),[D,f]=i.useState(!1),[S,P]=i.useState("creation"),[y,F]=i.useState("desc"),[N,E]=i.useState(""),Q=s=>C(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this supplier?")){l(s);try{yield u("Supplier",s),p()}catch(o){alert("Failed to delete supplier.")}finally{l(null)}}}),R=()=>C(void 0,null,function*(){var s;if(f(!0),h(null),!g.trim()){h("Supplier name cannot be empty."),f(!1);return}try{yield x("Supplier",{supplier_name:g.trim()}),a(!1),v(""),p()}catch(o){(s=o==null?void 0:o.message)!=null&&s.includes("exists")?h("A supplier with this name already exists."):h("Failed to create supplier.")}finally{f(!1)}}),w=c==null?void 0:c.filter(s=>s.supplier_name.toLowerCase().includes(N.toLowerCase())),A=w==null?void 0:w.sort((s,o)=>{const $=s[S],L=o[S],_=$<L?-1:$>L?1:0;return y==="asc"?_:-_});return e.jsx(Y,{p:"4",m:"4",children:e.jsxs(t,{direction:"column",gap:"4",children:[e.jsxs(t,{justify:"between",align:"center",children:[e.jsx(q,{size:"6",children:"Suppliers"}),e.jsxs(Z,{open:r,onOpenChange:a,children:[e.jsx(ee,{children:e.jsxs(d,{variant:"solid",color:"blue",size:"2",children:[e.jsx(H,{style:{marginRight:6}})," Add Supplier"]})}),e.jsxs(se,{style:{maxWidth:400},children:[e.jsx(re,{children:"Add a New Supplier"}),e.jsx(ie,{size:"2",children:"Enter the name of the new supplier."}),e.jsxs(t,{direction:"column",gap:"3",mt:"4",children:[e.jsx(O,{placeholder:"Supplier Name",value:g,onChange:s=>v(s.target.value)}),z&&e.jsx(b,{color:"red",size:"1",children:z})]}),e.jsxs(t,{gap:"3",mt:"4",justify:"end",children:[e.jsx(te,{children:e.jsx(d,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(d,{onClick:R,disabled:D,children:D?"Adding...":"Add Supplier"})]})]})]})]}),e.jsx(t,{direction:"column",gap:"4",children:e.jsxs(t,{justify:"space-between",align:"start",gap:"3",style:{width:"100%"},children:[e.jsx(O,{placeholder:"Search Supplier",value:N,onChange:s=>E(s.target.value),clearable:!0,onClear:()=>E(""),style:{flexGrow:1,minWidth:200,height:36}}),e.jsxs(t,{direction:"row",align:"start",gap:"2",children:[e.jsx(X,{sortField:S,setSortField:P,setSortOrder:F}),e.jsx(d,{variant:"soft",color:"gray",onClick:()=>F(y==="asc"?"desc":"asc"),size:"2",style:{height:36,padding:"0 12px"},children:y==="asc"?"Ascending":"Descending"})]})]})}),m?e.jsx(t,{align:"center",justify:"center",p:"6",children:e.jsx(J,{size:"3"})}):n?e.jsxs(b,{color:"red",size:"2",children:["Failed to load suppliers: ",n.message]}):!A||A.length===0?e.jsx(b,{size:"2",color:"gray",children:"No suppliers found."}):e.jsxs(M,{variant:"surface",children:[e.jsx(U,{children:e.jsxs(k,{children:[e.jsx(B,{children:"Name"}),e.jsx(B,{children:"Actions"})]})}),e.jsx(V,{children:A.map(s=>e.jsxs(k,{children:[e.jsx(I,{children:s.supplier_name}),e.jsx(I,{children:e.jsx(d,{onClick:()=>Q(s.name),variant:"outline",color:"red",size:"1",disabled:j===s.name,children:e.jsx(K,{})})})]},s.name))})]})]})})};export{me as default};
