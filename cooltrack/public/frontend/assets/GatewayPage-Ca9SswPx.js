var k=(w,u,l)=>new Promise((x,n)=>{var m=a=>{try{g(l.next(a))}catch(j){n(j)}},p=a=>{try{g(l.throw(a))}catch(j){n(j)}},g=a=>a.done?x(a.value):Promise.resolve(a.value).then(m,p);g((l=l.apply(w,u)).next())});import{a6 as Y,i as Z,a7 as h,$ as ee,E as A,j as e,n as s,p as r,x as ae,a8 as z,m as c,w as d,C as I,J as D,a9 as R,k as E,z as O,aa as F,ab as se,a1 as $,ac as B,ad as re,ae as G,af as J,ag as te,ah as ie,ai as W,aj as L,ak as oe}from"./index-BsqRx7K0.js";import{r as ne}from"./text-area-BqcxPxwB.js";import{o as C}from"./card-Cl9jFH-U.js";import{s as le,p as ce,g as de,m as xe,D as pe}from"./dialog-L3xT_XU3.js";import{o as P}from"./grid-C-tyneNj.js";import{o as f}from"./separator-BoVDTRez.js";import{m as ge,b as je,P as M}from"./tabs-CqwaVAKS.js";import"./index-CFk86qM9.js";import"./index-UYpWDUL8.js";const ye={LTE:e.jsx(oe,{className:"text-blue-500",size:20}),Ethernet:e.jsx(L,{className:"text-purple-500",size:20}),USB:e.jsx(W,{className:"text-green-500",size:20}),IoT:e.jsx(R,{className:"text-orange-500",size:20}),SS:e.jsx(L,{className:"text-purple-500",size:20}),WSA:e.jsx(W,{className:"text-green-500",size:20})},H={Active:{icon:e.jsx(R,{size:14}),color:"green"},Inactive:{icon:e.jsx(z,{size:14}),color:"gray"},Maintenance:{icon:e.jsx(ie,{size:14}),color:"orange"},Decommissioned:{icon:e.jsx(z,{size:14}),color:"red"}},U={Pending:{icon:e.jsx(J,{size:14}),color:"blue"},Approved:{icon:e.jsx(O,{size:14}),color:"green"},Rejected:{icon:e.jsx(F,{size:14}),color:"red"},Decommissioned:{icon:e.jsx(z,{size:14}),color:"gray"}},ke=()=>{const{id:w}=Y(),u=Z(),[l,x]=h.useState(!1),[n,m]=h.useState(""),[p,g]=h.useState("details"),{data:a,isLoading:j,error:v,mutate:_}=ee("Sensor Gateway",w),{call:N,loading:S}=A("frappe.client.set_value"),{call:V,loading:q}=A("frappe.client.set_value"),K=()=>k(void 0,null,function*(){try{yield N({doctype:"Sensor Gateway",name:a==null?void 0:a.name,fieldname:"approval_status",value:"Approved"}),_()}catch(t){console.error("Failed to approve gateway:",t)}}),Q=()=>k(void 0,null,function*(){try{yield N({doctype:"Sensor Gateway",name:a==null?void 0:a.name,fieldname:"approval_status",value:"Rejected"}),n&&(yield V({doctype:"Sensor Gateway",name:a==null?void 0:a.name,fieldname:"notes",value:`Gateway rejected. Reason: ${n}`})),_(),x(!1),m("")}catch(t){console.error("Failed to reject gateway:",t)}}),T=t=>t?new Date(t).toLocaleString():"Not available",X=({title:t,icon:i})=>e.jsxs(r,{gap:"3",align:"center",mb:"3",children:[e.jsx(s,{style:{padding:"6px",borderRadius:"6px",background:"var(--gray-3)",color:"var(--gray-11)"},children:i}),e.jsx(E,{size:"4",weight:"medium",style:{color:"var(--gray-12)"},children:t})]}),y=({title:t,icon:i,children:b})=>e.jsx(C,{variant:"surface",style:{borderRadius:"12px",border:"1px solid var(--gray-4)",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.05)",transition:"all 0.2s ease",background:"var(--color-surface)"},children:e.jsxs(s,{p:"4",children:[e.jsx(X,{title:t,icon:i}),e.jsx(s,{style:{marginTop:"12px"},children:b})]})}),o=({label:t,value:i,icon:b})=>e.jsxs(r,{direction:"column",gap:"2",py:"3",children:[e.jsxs(r,{align:"center",gap:"2",children:[b&&e.jsx(s,{style:{color:"var(--gray-9)"},children:b}),e.jsx(c,{size:"1",weight:"medium",style:{color:"var(--gray-10)",textTransform:"uppercase",letterSpacing:"0.5px"},children:t})]}),e.jsx(c,{size:"2",weight:"medium",style:{color:i?"var(--gray-12)":"var(--gray-9)",fontFamily:typeof i=="number"?"var(--font-mono, monospace)":"inherit"},children:(i==null?void 0:i.toLocaleString())||"â€”"})]});return j?e.jsx(s,{style:{background:"var(--gray-1)"},children:e.jsx(r,{justify:"center",align:"center",style:{height:"80vh"},children:e.jsx(r,{direction:"column",gap:"3",align:"center",children:e.jsx(ae,{size:"3"})})})}):v||!a?e.jsx(s,{style:{background:"var(--gray-1)"},p:"4",children:e.jsx(s,{style:{height:"80vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{style:{maxWidth:"400px",width:"100%",borderRadius:"16px",border:"1px solid var(--red-6)",background:"var(--red-2)"},children:e.jsxs(r,{direction:"column",gap:"4",align:"center",p:"6",children:[e.jsx(s,{style:{opacity:.8},children:e.jsx(z,{size:32,color:"var(--red-9)"})}),e.jsx(c,{color:"red",weight:"bold",size:"4",children:"Error loading gateway"}),e.jsx(c,{color:"red",size:"2",style:{textAlign:"center"},children:(v==null?void 0:v.message)||"Gateway not found"}),e.jsxs(d,{onClick:()=>u("/settings"),variant:"soft",style:{marginTop:"8px",borderRadius:"8px"},children:[e.jsx(I,{size:14,style:{marginRight:"8px"}}),"Back to Settings"]})]})})})}):e.jsxs(s,{style:{background:"var(--gray-1)"},children:[e.jsx(s,{style:{background:"var(--color-surface)",borderBottom:"1px solid var(--gray-4)",padding:"12px 24px",top:0,zIndex:10,boxShadow:"0 1px 3px rgba(0, 0, 0, 0.05)"},children:e.jsxs(r,{justify:"between",align:"center",children:[e.jsxs(d,{variant:"soft",onClick:()=>u("/settings"),size:"1",style:{borderRadius:"6px",transition:"all 0.2s ease",fontSize:"13px"},children:[e.jsx(I,{size:12,style:{marginRight:"6px"}}),"Back to Settings"]}),e.jsxs(r,{gap:"2",align:"center",children:[e.jsx(D,{color:H[a.status].color,variant:"soft",size:"1",style:{borderRadius:"16px",padding:"4px 8px",textTransform:"uppercase",fontSize:"10px",fontWeight:"600",letterSpacing:"0.3px"},children:e.jsxs(r,{gap:"1",align:"center",children:[h.cloneElement(H[a.status].icon),a.status]})}),e.jsx(D,{color:U[a.approval_status].color,variant:"soft",size:"1",style:{borderRadius:"16px",padding:"4px 8px",textTransform:"uppercase",fontSize:"10px",fontWeight:"600",letterSpacing:"0.3px"},children:e.jsxs(r,{gap:"1",align:"center",children:[h.cloneElement(U[a.approval_status].icon),a.approval_status]})})]})]})}),e.jsxs(s,{px:"6",py:"4",style:{width:"100%"},children:[e.jsxs(C,{style:{borderRadius:"16px",border:"1px solid var(--gray-4)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",marginBottom:"24px",background:"var(--color-surface)"},children:[e.jsxs(r,{gap:"4",align:"center",p:"6",children:[e.jsx(s,{style:{padding:"16px",background:"var(--gray-2)",borderRadius:"12px",border:"1px solid var(--gray-4)",display:"flex",alignItems:"center",justifyContent:"center"},children:ye[a.gateway_type]||e.jsx(R,{size:24})}),e.jsxs(r,{direction:"column",gap:"1",children:[e.jsx(E,{size:"5",weight:"bold",style:{color:"var(--gray-12)"},children:a.location||a.name}),e.jsxs(c,{color:"gray",size:"2",style:{fontFamily:"var(--font-mono, monospace)",letterSpacing:"0.2px"},children:["ID: ",a.name]})]})]}),a.approval_status==="Pending"&&e.jsx(s,{style:{background:"var(--gray-2)",borderTop:"1px solid var(--gray-4)",borderRadius:"0 0 16px 16px"},children:e.jsxs(r,{gap:"3",p:"4",justify:"end",children:[e.jsxs(d,{variant:"solid",color:"green",onClick:K,disabled:S,size:"2",style:{borderRadius:"8px",transition:"all 0.2s ease"},children:[e.jsx(O,{size:14,style:{marginRight:"6px"}}),"Approve"]}),e.jsxs(d,{variant:"soft",color:"red",onClick:()=>x(!0),disabled:S,size:"2",style:{borderRadius:"8px",transition:"all 0.2s ease"},children:[e.jsx(F,{size:14,style:{marginRight:"6px"}}),"Reject"]})]})})]}),e.jsxs(ge,{value:p,onValueChange:g,children:[e.jsx(s,{style:{background:"var(--color-surface)",borderRadius:"12px",padding:"8px",border:"1px solid var(--gray-4)",marginBottom:"20px"},children:e.jsxs(je,{style:{background:"transparent",gap:"4px"},children:[e.jsx(M,{value:"details",style:{borderRadius:"8px",padding:"8px 16px",transition:"all 0.2s ease",fontWeight:"500"},children:"Details"}),e.jsx(M,{value:"connectivity",style:{borderRadius:"8px",padding:"8px 16px",transition:"all 0.2s ease",fontWeight:"500"},children:"Connectivity"})]})}),e.jsxs(s,{style:{width:"100%"},children:[p==="details"&&e.jsxs(P,{columns:{initial:"1",sm:"2",lg:"3",xl:"4"},gap:"4",children:[e.jsxs(y,{title:"Basic Information",icon:e.jsx($,{}),children:[e.jsx(o,{label:"Gateway Type",value:a.gateway_type,icon:e.jsx(R,{})}),e.jsx(f,{size:"1",style:{background:"var(--gray-4)"}}),e.jsx(o,{label:"Model Number",value:a.model_number,icon:e.jsx(se,{})})]}),e.jsxs(y,{title:"Location",icon:e.jsx(re,{}),children:[e.jsx(o,{label:"Site Location",value:a.location}),e.jsx(f,{size:"1",style:{background:"var(--gray-4)"}}),e.jsx(o,{label:"Installed On",value:T(a.installation_date),icon:e.jsx(B,{})})]}),e.jsxs(y,{title:"Activity",icon:e.jsx(J,{}),children:[e.jsx(o,{label:"Last Heartbeat",value:T(a.last_heartbeat),icon:e.jsx(B,{})}),e.jsx(f,{size:"1",style:{background:"var(--gray-4)"}}),e.jsx(o,{label:"Transmissions",value:a.number_of_transmissions,icon:e.jsx(G,{})}),e.jsx(f,{size:"1",style:{background:"var(--gray-4)"}})]}),e.jsx(y,{title:"Notes",icon:e.jsx($,{}),children:e.jsx(o,{label:"Notes",value:a.notes})})]}),p==="connectivity"&&e.jsx(P,{columns:{initial:"1",sm:"2",lg:"3"},gap:"4",children:e.jsx(y,{title:"Network",icon:e.jsx(te,{}),children:e.jsx(o,{label:"IP Address",value:a.ip_address,icon:e.jsx(G,{})})})})]})]})]}),e.jsx(le,{open:l,onOpenChange:x,children:e.jsxs(ce,{style:{maxWidth:450,borderRadius:"16px",border:"1px solid var(--gray-4)",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.15)"},children:[e.jsx(de,{style:{marginBottom:"8px"},children:"Reject Gateway"}),e.jsx(xe,{size:"2",mb:"4",style:{color:"var(--gray-11)"},children:"Please provide a reason for rejecting this gateway."}),e.jsx(r,{direction:"column",gap:"3",children:e.jsxs("label",{children:[e.jsx(c,{as:"div",size:"2",mb:"2",weight:"medium",style:{color:"var(--gray-12)"},children:"Reason"}),e.jsx(ne,{placeholder:"Enter rejection reason...",value:n,onChange:t=>m(t.target.value),style:{minHeight:"100px",borderRadius:"8px",border:"1px solid var(--gray-6)",resize:"vertical"}})]})}),e.jsxs(r,{gap:"3",mt:"5",justify:"end",children:[e.jsx(pe,{children:e.jsx(d,{variant:"soft",color:"gray",style:{borderRadius:"8px"},children:"Cancel"})}),e.jsxs(d,{variant:"solid",color:"red",onClick:Q,disabled:!n||S||q,style:{borderRadius:"8px"},children:[e.jsx(F,{size:14,style:{marginRight:"6px"}}),"Confirm Reject"]})]})]})})]})};export{ke as default};
