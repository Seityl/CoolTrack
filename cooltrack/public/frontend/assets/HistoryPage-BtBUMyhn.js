var L=(o,u,a)=>new Promise((p,c)=>{var y=t=>{try{j(a.next(t))}catch(h){c(h)}},d=t=>{try{j(a.throw(t))}catch(h){c(h)}},j=t=>t.done?p(t.value):Promise.resolve(t.value).then(y,d);j((a=a.apply(o,u)).next())});import{r as l,g as H,j as e,p as x,s as I,c as R,b as D,a as P,o as $,ab as k}from"./index-C04qYfe-.js";import{u as B}from"./text-field-CMR2eUSf.js";import{C as M,u as T,g as E,v as m}from"./select-zUghpQEI.js";import{o as N}from"./card-C5T3GK1O.js";import{m as O,d as F,P as _,f as n,b as W,T as r}from"./table-BXFL9hTW.js";import"./scroll-area-C6CETP3U.js";import"./get-subtree-DIlR1yYT.js";import"./index-rTswdvp2.js";import"./index-CuX96acz.js";import"./index-DDgf8gTd.js";const te=()=>{const[o,u]=l.useState(""),[a,p]=l.useState("sensor_id"),[c,y]=l.useState("desc"),[d,j]=l.useState(100),[t,h]=l.useState(!1),{data:i,error:w,isLoading:V,mutate:v,isValidating:f}=H("frappe.client.get_list",{doctype:"Sensor Read",fields:["sensor_id","sensor_type","temperature","humidity","voltage","signal_strength","sequence_number","gateway_id","relay_id","sensor_rssi","coordinates","timestamp"],order_by:`${a} ${c}`,limit_page_length:d}),g=l.useMemo(()=>((i==null?void 0:i.message)||[]).filter(s=>{var b,C;const S=((b=s.sensor_id)==null?void 0:b.toLowerCase())||"",G=((C=s.gateway_id)==null?void 0:C.toLowerCase())||"";return S.includes(o.toLowerCase())||G.includes(o.toLowerCase())}),[i,o]),q=()=>{j(s=>s+100)},z=()=>L(void 0,null,function*(){h(!0);try{yield v()}finally{h(!1)}});l.useEffect(()=>{v()},[a,c,d]);const A=l.useMemo(()=>(i==null?void 0:i.message)&&i.message.length>=d&&g.length>0,[i,d,g]);return V&&!i?e.jsx(x,{align:"center",justify:"center",height:"100vh",children:e.jsx(I,{size:"3"})}):w?e.jsx(x,{align:"center",justify:"center",height:"100vh",children:e.jsxs(R,{color:"red",children:["Error loading sensor reads: ",w.message]})}):e.jsxs(D,{p:"4",children:[e.jsxs(x,{justify:"between",align:"center",mb:"4",children:[e.jsx(P,{size:"6",children:"History"}),e.jsx(x,{gap:"3",children:e.jsxs($,{variant:"soft",onClick:z,disabled:t||f,children:[e.jsx(k,{className:t?"animate-spin":""}),"Refresh"]})})]}),e.jsxs(x,{gap:"3",mb:"4",wrap:"wrap",children:[e.jsx(D,{style:{flexGrow:1,minWidth:"300px"},children:e.jsx(B,{placeholder:"Search by Sensor ID or Gateway ID",value:o,onChange:s=>u(s.target.value)})}),e.jsxs(M,{value:a,onValueChange:s=>p(s),children:[e.jsx(T,{}),e.jsxs(E,{children:[e.jsx(m,{value:"timestamp",children:"Sort by Timestamp"}),e.jsx(m,{value:"sensor_id",children:"Sort by Sensor ID"})]})]}),e.jsxs(M,{value:c,onValueChange:s=>y(s),children:[e.jsx(T,{}),e.jsxs(E,{children:[e.jsx(m,{value:"desc",children:"Descending"}),e.jsx(m,{value:"asc",children:"Ascending"})]})]})]}),e.jsxs(N,{children:[e.jsxs(O,{variant:"surface",size:"2",children:[e.jsx(F,{children:e.jsxs(_,{children:[e.jsx(n,{children:"Sensor ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Temperature"}),e.jsx(n,{children:"Humidity"}),e.jsx(n,{children:"Voltage"}),e.jsx(n,{children:"Signal Strength"}),e.jsx(n,{children:"Seq #"}),e.jsx(n,{children:"Gateway"}),e.jsx(n,{children:"RSSI"}),e.jsx(n,{children:"Coordinates"}),e.jsx(n,{children:"Timestamp"})]})}),e.jsx(W,{children:g.length>0?g.map((s,S)=>e.jsxs(_,{children:[e.jsx(r,{children:s.sensor_id}),e.jsx(r,{children:s.sensor_type}),e.jsx(r,{children:s.temperature}),e.jsx(r,{children:s.humidity}),e.jsx(r,{children:s.voltage}),e.jsx(r,{children:s.signal_strength}),e.jsx(r,{children:s.sequence_number}),e.jsx(r,{children:s.gateway_id}),e.jsx(r,{children:s.sensor_rssi}),e.jsx(r,{children:s.coordinates}),e.jsx(r,{children:new Date(s.timestamp).toLocaleString()})]},S)):e.jsx(_,{children:e.jsx(r,{colSpan:12,style:{textAlign:"center"},children:e.jsx(R,{color:"gray",children:"No matching records found"})})})})]}),A&&e.jsx(x,{justify:"center",mt:"4",children:e.jsx($,{onClick:q,disabled:f,children:f?e.jsx(I,{}):"Load More"})})]})]})};export{te as default};
